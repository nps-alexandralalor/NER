---
title: "QAQC for FMH Data"
author: "Alexandra Lalor"
output:
  html_document:
    theme: readable
    highlight: 
    toc: yes
    toc_depth: 1
    toc_float:
      smooth_scroll: yes
    code_download: true
  pdf_document:
    toc: yes
    toc_depth: 1
---

# PURPOSE

This code is intended to combine FFI files into flat files to be used with subsequent R scripts.

The Sample Event Report and Macroplot Report can be downloaded via the Utilities menu on the Project Management tab on the FFI Remote App Server.

-   MacroplotReport.csv

-   SampleEventReport.csv

The Local Species Report can be downloaded via the Species menu on the Species Management tab on the FFI Remote App Server.

-   LocalSpeciesReport.csv

The Protocol data can be downloaded via Query tab on the FFI Remote App Server by using the saved queries from the drop down options.

-   Surface Fuels - 1000Hr_XPT.csv

-   Surface Fuels - Duff_Litter_XPT.csv

-   Surface Fuels - Fine_XPT.csv

-   Post Burn Severity (metric)\_XPT.csv

-   Trees - Individuals (metric)\_XPT.csv

-   Density - Quadrats (metric)\_XPT.csv

-   Density - Belts (metric)\_XPT.csv

-   Cover - Species Composition (metric)\_XPT.csv

-   Cover - Points (metric)\_XPT.csv

## BEFORE STARTING {.hidden}

### Setup {.hidden}

```{r setup, include=FALSE}
## Markdown Options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
# install.packages("tidyverse")
# install.packages("Rtools")
# install.packages("janitor")
# install.packages("condformat")
# install.packages("knitr")
# install.packages("here")
# install.packages("EnvStats")
```

```{r}
# tidyverse and dplyr have lots of useful functions for data cleaning
library(tidyverse)
library(dplyr)
# knitr is used to create output files from R Markdown
library(knitr)
```

### Adjust File Paths {.hidden}

```{r}
# adjust file paths
#path_main <- "E:/Allie/FireFX_NER/FFI Data Management/"
path_main <- "C:/Users/alalor/OneDrive - DOI/NER/FireFX/FFI Data Management/"
```

### Parks {.hidden}

```{r}
parks <- c("ANTI", "APCO", "CATO", "CUVA", "DEWA", "FRSP", "GATE", "GETT", "MONO", "NERI", "PRWI", "RICH", "SARA", "SHEN", "VAFO")
```

# METADATA

## Sample Event & Macroplot Report

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  MacroplotReport <- read.csv(paste0(path_data, "MacroplotReport.csv"), na.strings = c("","NA","N/A"))
  SampleEventReport <- read.csv(paste0(path_data, "SampleEventReport.csv"), na.strings = c("","NA","N/A"))
  
  
  # clean & filter data
  #### Macroplot Report
  # The Macroplot Report contains information on both plot metadata and sample event history. Separate these into 2 tables.
  MacroplotReport_MetaData <- MacroplotReport %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # separate tables
    filter(is.na(SampleEventDate)) %>%
    # separate Date columns into Date and Time columns
    separate(DateIn, sep = " ", 
             into = c("Macroplot_DateIn", "DateInTime")) %>%
    separate(FutureVisit, sep = " ", 
             into = c("Macroplot_FutureVisit", "FutureVisitTime")) %>%
    separate(DateOut, sep = " ", 
             into = c("Macroplot_DateOut", "DateOutTime")) %>%
    # reformate Date columns
    mutate(
      Macroplot_DateIn = as.Date(Macroplot_DateIn, "%m/%d/%Y"),
      Macroplot_FutureVisit = as.Date(Macroplot_FutureVisit, "%m/%d/%Y"),
      Macroplot_DateOut = as.Date(Macroplot_DateOut, "%m/%d/%Y")
      ) %>%
    # add Year columns
    mutate(
      Macroplot_DateIn_Year = year(Macroplot_DateIn),
      Macroplot_FutureVisit_Year = year(Macroplot_FutureVisit),
      Macroplot_DateOut_Year = year(Macroplot_DateOut)
    ) %>% 
    relocate(Macroplot_DateIn_Year, .after = Macroplot_DateIn) %>% 
    relocate(Macroplot_FutureVisit_Year, .after = Macroplot_FutureVisit) %>% 
    relocate(Macroplot_DateOut_Year, .after = Macroplot_DateOut) %>%
    # make column names consistent
    dplyr::rename(Macroplot_Name = Macroplot) %>% 
    # remove unnecessary columns
    select(!c(DateInTime, FutureVisitTime, DateOutTime)) %>% 
    select(!c(SampleEventDate, SampleEventTeam, SampleEventComment, 
              MonStatusOrd, LegacyMonStatus, MonStatus))

  MacroplotReport_SampleEvents <- MacroplotReport %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # separate tables
    filter(!is.na(SampleEventDate)) %>%
    # separate Date columns into Date and Time columns
    separate(SampleEventDate, sep = " ", 
             into = c("SampleEvent_Date", "SampleEvent_Time")) %>%
    # reformate Date columns
    mutate(SampleEvent_Date = as.Date(SampleEvent_Date, "%m/%d/%Y")) %>%
    # add Year columns
    mutate(SampleEvent_Date_Year = year(SampleEvent_Date)) %>% 
    relocate(SampleEvent_Date_Year, .after = SampleEvent_Date) %>% 
    # make column names consistent
    dplyr::rename(Macroplot_Name = Macroplot,
                  SampleEvent_LegacyMonitoringStatus = LegacyMonStatus,
                  SampleEvent_Who = SampleEventTeam,
                  SampleEvent_Comment = SampleEventComment,
                  MonitoringStatus_Name = MonStatus,
                  MonitoringStatus_Order = MonStatusOrd) %>% 
    # remove unnecessary columns
    select(!c(SampleEvent_Time)) %>%
    select(c(Macroplot_Name, SampleEvent_Date, SampleEvent_Date_Year, 
             SampleEvent_Who, SampleEvent_Comment, MonitoringStatus_Order, 
             SampleEvent_LegacyMonitoringStatus, MonitoringStatus_Name))
  
  #### Sample Event Report
  # The Sample Event Report has different column names as the Macroplot Report, but contains the same information. Make column names consistent.
  SampleEventReport_clean <- SampleEventReport %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # separate Date columns into Date and Time columns
    separate(SampleEvent_Date, sep = " ", 
             into = c("SampleEvent_Date", "SampleEvent_Time")) %>%
    # reformate Date columns
    mutate(SampleEvent_Date = as.Date(SampleEvent_Date, "%m/%d/%Y")) %>%
    # add Year columns
    mutate(SampleEvent_Date_Year = year(SampleEvent_Date)) %>% 
    relocate(SampleEvent_Date_Year, .after = SampleEvent_Date) %>% 
    # make column names consistent
    dplyr::rename(AdminUnit_Name = AdministrationUnit_Name,
                  Macroplot_Name = MacroPlot_Name,
                  SampleEvent_Protocols = Protocols,
                  SampleEvent_Visited = Visited) %>% 
    # remove unnecessary columns
    select(!c(SampleEvent_Time, SampleEvent_LegacyMonitoringStatus))
  
  
  # merge data
  #### Merge MacroplotReport_Metadata and MacroplotReport_SampleEvents
  MacroplotReport_merge <- merge(MacroplotReport_MetaData, MacroplotReport_SampleEvents, by = c("Macroplot_Name")) %>%
    select(!MonitoringStatus_Order)
  
  #### Filter Sample Event Report for merging
  SampleEventReport_merge <- SampleEventReport_clean %>%
    filter(ProjectUnit_Name != "ALL") %>% 
    select(!c(Multi_PU))
  
  #### Merge Macroplot Report and Sample Event Report
  MetadataReport <- merge(MacroplotReport_merge, SampleEventReport_merge, by = c("Macroplot_Name", "SampleEvent_Date", "SampleEvent_Date_Year", "MonitoringStatus_Name")) %>%
    relocate(AdminUnit_Name, .before = Macroplot_Name) %>%
    relocate(ProjectUnit_Name, .after = Purpose) %>%
    relocate(Type, .after = Purpose) %>% 
    relocate(Macroplot_Name, .after = Type) %>%
    relocate(SampleEvent_Date, .after = SampleEvent_Visited) %>%
    relocate(SampleEvent_Date_Year, .after = SampleEvent_Date) %>% 
    relocate(MonitoringStatus_Name, .after = SampleEvent_LegacyMonitoringStatus) %>%
    relocate(LocatedBy, .before = StartPoint)
  
  # final column renaming to match protocol exports
    MetadataReport <- MetadataReport %>% 
      dplyr::rename(
        Macroplot_Purpose = Purpose,
        Macroplot_Type = Type,
        #Macroplot_DdLat = Latitude,
        #Macroplot_DdLong = Longitude,
        #"Macroplot_UtmX (m)" = UTM_X,
        #"Macroplot_UtmY (m)" = UTM_Y,
        #Macroplot_UtmZone = UTM_Zone,
        #Macroplot_Datum = Datum,
        #Macroplot_Pdop = PDOP,
        #Macroplot_Precision = Precision,
        #Macroplot_Elevation = Elevation,
        #Macroplot_ElevationUnits = ElevationUnits,
        #Macroplot_Azimuth = Azimuth,
        #Macroplot_Aspect = Aspect,
        #"Macroplot_SlopeHill (%)" = SlopeHill,
        #"Macroplot_SlopeTransect (%)" = SlopeTransect,
        #Macroplot_LocatedBy = LocatedBy,
        #Macroplot_StartPoint = StartPoint,
        #Macroplot_Directions = Directions,
        #Macroplot_Comment = Comments,
        #Macroplot_Metadata = MetaData,
        Macroplot_UV1 = UV1,
        Macroplot_UV2 = UV2,
        Macroplot_UV3 = UV3,
        Macroplot_UV4 = UV4,
        Macroplot_UV5 = UV5,
        Macroplot_UV6 = UV6,
        Macroplot_UV7 = UV7,
        Macroplot_UV8 = UV8
        #SampleEvent_DefaultMonitoringStatus =  # Does this have an equivalent?
        #SampleEvent_LegacyMonitoringStatus = # Does this have an equivalent?
        )
  
  # replace commas with semicolons
  MetadataReport[] <- lapply(MetadataReport, function(x) gsub(",", ";", x))
  
  
  # save file
  write.csv(MetadataReport, paste0(path_save, target_park, "_MetadataReport.csv"), quote = FALSE, row.names = FALSE) 
}
```

# SPECIES

## Species Report

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  SpeciesReport <- read.csv(paste0(path_data, "LocalSpeciesReport.csv"), na.strings = c("","NA","N/A"))

  
  # clean data
  SpeciesReport <- SpeciesReport %>%
  # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim))
  ## replace commas with semicolons
  SpeciesReport[] <- lapply(SpeciesReport, function(x) gsub(",", ";", x))
  
  
  
  # # final column renaming to match protocol exports
  #   SpeciesReport <- SpeciesReport %>%
  #     dplyr::rename(
  #       Species_SourceEntityId = LocalSpecies_GUID,
  #       Species_ITISTaxonomicSerialNumber = MasterSpecies_ITIS_TSN,
  #       Species_SymbolLocal = LocalSpecies_Symbol,
  #       #Species_Symbol = # not on species report
  #       Species_Description = LocalSpecies_Description,
  #       Species_CommonNameLocal = LocalSpecies_CommonName,
  #       #Species_CommonName = # not on species report
  #       Species_LifeCycleLocal = LocalSpecies_LifeCycle,
  #       #Species_LifeCycle = # not on species report
  #       # = LocalSpecies_UserAdded, # not on data depot outputs
  #       Species_NativityLocal = LocalSpecies_Nativity,
  #       #Species_Nativity = # not on species report
  #       Species_Invasive = LocalSpecies_Invasive,
  #       Species_Cultural = LocalSpecies_Cultural,
  #       Species_Concern = LocalSpecies_Concern,
  #       Species_Retired = LocalSpecies_Retired,
  #       Species_Comment = LocalSpecies_Comment,
  #       Species_UV1 = LocalSpecies_UV1,
  #       Species_UV2 = LocalSpecies_UV2,
  #       Species_UV3 = LocalSpecies_UV3,
  #       Species_LifeFormNameLocal = LocalSpecies_PreferedLifeForm,
  #       #Species_LifeFormName = # not on species report
  #       Species_ScientificName = MasterSpecies_ScientificName,
  #       Species_Genus = MasterSpecies_Genus,
  #       Species_Family = MasterSpecies_Family,
  #       Species_NotBiological = MasterSpecies_NotBiolgoical,
  #       # = ReportType # not on data depot outputs
  #       )

  
  # save file
  write.csv(SpeciesReport, paste0(path_save, target_park, "_SpeciesReport.csv"), quote = FALSE, row.names = FALSE)
}
```

# PROTOCOLS

## Fuels 1000

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  Fuels1000_all <- read.csv(paste0(path_data, "Surface Fuels - 1000Hr_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  Fuels1000_all <- Fuels1000_all[, -ncol(Fuels1000_all)]
  ## replace commas with semicolons
  Fuels1000_all[] <- lapply(Fuels1000_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  Fuels1000_all <- Fuels1000_all %>%
  # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## Fuels1000 headers
  Fuels1000_header <- Fuels1000_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19, 
             NumTran, TranLen, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## Fuels1000 data
  Fuels1000_data <- Fuels1000_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, TranLen, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))


  # merge data
  Fuels1000 <- merge(Fuels1000_header, Fuels1000_data, by = c(1:19))
  
  
  # add column for park name
  Fuels1000 <- Fuels1000 %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  Fuels1000 <- Fuels1000 %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(Fuels1000, paste0(path_save, target_park, "_Data_Surface Fuels - 1000Hr.csv"), quote = FALSE, row.names = FALSE)
}
```

## Fuels Duff Litt

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  FuelsDuffLitt_all <- read.csv(paste0(path_data, "Surface Fuels - Duff_Litter_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  FuelsDuffLitt_all <- FuelsDuffLitt_all[, -ncol(FuelsDuffLitt_all)]
  ## replace commas with semicolons
  FuelsDuffLitt_all[] <- lapply(FuelsDuffLitt_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  FuelsDuffLitt_all <- FuelsDuffLitt_all %>%  
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## FuelsDuffLitt headers
  FuelsDuffLitt_header <- FuelsDuffLitt_all %>%   
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## FuelsDuffLitt data
  FuelsDuffLitt_data <- FuelsDuffLitt_all %>%   
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  FuelsDuffLitt <- merge(FuelsDuffLitt_header, FuelsDuffLitt_data, by = c(1:19))
  
  
  # add column for park name
  FuelsDuffLitt <- FuelsDuffLitt %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  FuelsDuffLitt <- FuelsDuffLitt %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(FuelsDuffLitt, paste0(path_save, target_park, "_Data_Surface Fuels - Duff_Litter.csv"), quote = FALSE, row.names = FALSE) 
}
```

## Fuels Fine

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  FuelsFine_all <- read.csv(paste0(path_data, "Surface Fuels - Fine_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  FuelsFine_all <- FuelsFine_all[, -ncol(FuelsFine_all)]
  ## replace commas with semicolons
  FuelsFine_all[] <- lapply(FuelsFine_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  FuelsFine_all <- FuelsFine_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## FuelsFine headers 
  FuelsFine_header <- FuelsFine_all %>%   
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, OneHrTranLen, TenHrTranLen, HunHrTranLen, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
## FuelsFine data
  FuelsFine_data <- FuelsFine_all %>%   
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, OneHrTranLen, TenHrTranLen, HunHrTranLen, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  FuelsFine <- merge(FuelsFine_header, FuelsFine_data, by = c(1:19))
  
  
  # add column for park name
  FuelsFine <- FuelsFine %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  FuelsFine <- FuelsFine %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(FuelsFine, paste0(path_save, target_park, "_Data_Surface Fuels - Fine.csv"), quote = FALSE, row.names = FALSE) 
}
```

## Post Burn

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  PostBurn_all <- read.csv(paste0(path_data, "Post Burn Severity (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  PostBurn_all <- PostBurn_all[, -ncol(PostBurn_all)]
  ## replace commas with semicolons
  PostBurn_all[] <- lapply(PostBurn_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  PostBurn_all <- PostBurn_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## PostBurn headers
  PostBurn_header <- PostBurn_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, TranLen, NumPtsTran, PlotType, PtArea, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## PostBurn data
  PostBurn_data <- PostBurn_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, TranLen, NumPtsTran, PlotType, PtArea, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  PostBurn <- merge(PostBurn_header, PostBurn_data, by = c(1:19))
  
  
  # add column for park name
  PostBurn <- PostBurn %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  PostBurn <- PostBurn %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(PostBurn, paste0(path_save, target_park, "_Data_Post Burn Severity (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```

## Trees

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  Trees_all <- read.csv(paste0(path_data, "Trees - Individuals (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  Trees_all <- Trees_all[, -ncol(Trees_all)]
  ## replace commas with semicolons
  Trees_all[] <- lapply(Trees_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  Trees_all <- Trees_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## Trees headers
  Trees_header <- Trees_all %>%   
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             MacroPlotSize, SnagPlotSize, BrkPntDia, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## Trees data
  Trees_data <- Trees_all %>%   
    filter(is.na(Visited)) %>% 
    select(!c(MacroPlotSize, SnagPlotSize, BrkPntDia, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  Trees <- merge(Trees_header, Trees_data, by = c(1:19))
  
  
  # add column for park name
  Trees <- Trees %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  Trees <- Trees %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(Trees, paste0(path_save, target_park, "_Data_Trees - Individuals (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```

## Seedlings

```{r}
# excluding park PRWI because of database exporting issues
# excluding park APCO because Density - Quadrats (metric) aka Seedlings protocol does not include Area header...

for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  Seedlings_all <- read.csv(paste0(path_data, "Density - Quadrats (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  Seedlings_all <- Seedlings_all[, -ncol(Seedlings_all)]
  ## replace commas with semicolons
  Seedlings_all[] <- lapply(Seedlings_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  Seedlings_all <- Seedlings_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## Seedlings headers
  Seedlings_header <- Seedlings_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, NumQuadTran, QuadLen, QuadWid, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## Seedlings data
  Seedlings_data <- Seedlings_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, NumQuadTran, QuadLen, QuadWid, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  Seedlings <- merge(Seedlings_header, Seedlings_data, by = c(1:19))
  
  
  # add column for park name
  Seedlings <- Seedlings %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  Seedlings <- Seedlings %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(Seedlings, paste0(path_save, target_park, "_Data_Density - Quadrats (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```

## Shrubs

```{r}
# excluding park PRWI because of database exporting issues
# excluding park APCO because Density - Belts (metric) aka Shrubs protocol does not include Subbelt, NumSubbelt, or Area header...

for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  Shrubs_all <- read.csv(paste0(path_data, "Density - Belts (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  Shrubs_all <- Shrubs_all[, -ncol(Shrubs_all)]
  ## replace commas with semicolons
  Shrubs_all[] <- lapply(Shrubs_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  Shrubs_all <- Shrubs_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## Shrubs headers
  Shrubs_header <- Shrubs_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, NumSubbelt, TranLen, TranWid, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## Shrubs data
  Shrubs_data <- Shrubs_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, NumSubbelt, TranLen, TranWid, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  Shrubs <- merge(Shrubs_header, Shrubs_data, by = c(1:19))
  
  
  # add column for park name
  Shrubs <- Shrubs %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  Shrubs <- Shrubs %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(Shrubs, paste0(path_save, target_park, "_Data_Density - Belts (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```

## Herbs Species Comp

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  HerbsSpComp_all <- read.csv(paste0(path_data, "Cover - Species Composition (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  HerbsSpComp_all <- HerbsSpComp_all[, -ncol(HerbsSpComp_all)]
  ## replace commas with semicolons
  HerbsSpComp_all[] <- lapply(HerbsSpComp_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  HerbsSpComp_all <- HerbsSpComp_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## HerbsSpComp headers
  HerbsSpComp_header <- HerbsSpComp_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             MinCovLevel, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## HerbsSpComp data
  HerbsSpComp_data <- HerbsSpComp_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(MinCovLevel, Area, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  HerbsSpComp <- merge(HerbsSpComp_header, HerbsSpComp_data, by = c(1:19))
  
  
  # add column for park name
  HerbsSpComp <- HerbsSpComp %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  HerbsSpComp <- HerbsSpComp %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(HerbsSpComp, paste0(path_save, target_park, "_Data_Cover - Species Composition (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```

## Herbs Points

```{r}
for(i in parks) {
  # select target park
  target_park <- i
  
  
  # adjust file paths
  path_data <- paste0(path_main, "Exports/", target_park, "/", target_park, "_")
  path_save <- paste0(path_main, "R Outputs/", target_park, "/")
  
  
  # load data
  HerbsPoints_all <- read.csv(paste0(path_data, "Cover - Points (metric)_XPT.csv"), na.strings = c("","NA","N/A"))
  ## Drop last column if it's an empty placeholder (common in Excel exports)
  HerbsPoints_all <- HerbsPoints_all[, -ncol(HerbsPoints_all)]
  ## replace commas with semicolons
  HerbsPoints_all[] <- lapply(HerbsPoints_all, function(x) gsub(",", ";", x))
  
  
  # clean data
  HerbsPoints_all <- HerbsPoints_all %>%
    # remove trailing/leading whitespace
    mutate(across(where(is.character), str_trim)) %>%
    # Separate Date column
    separate(Date, sep = " ", into = c("Date", "Time")) %>%
    separate(Date, sep = "/", into = c("Month", "Day", "Date_Year"), remove = FALSE) %>%
    # Reformat Date column
    mutate(Date = as.Date(Date, format = "%m/%d/%Y")) %>%
    # Remove Month, Day, and Time columns
    select(!c("Month", "Day", "Time"))
  
  
  # filter data
  ## HerbsPoints headers
  HerbsPoints_header <- HerbsPoints_all %>%
    filter(!is.na(Visited)) %>% 
    select(c(1:19,
             NumTran, TranLen, NumPtsTran, Offset, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  ## HerbsPoints data
  HerbsPoints_data <- HerbsPoints_all %>%
    filter(is.na(Visited)) %>% 
    select(!c(NumTran, TranLen, NumPtsTran, Offset, FieldTeam, EntryTeam, UV1Desc, UV2Desc, UV3Desc, SaComment, Visited))
  
  
  # merge data
  HerbsPoints <- merge(HerbsPoints_header, HerbsPoints_data, by = c(1:19))
  
  
  # add column for park name
  HerbsPoints <- HerbsPoints %>% 
    add_column(AdministrationUnit_Name = target_park, .before = "MacroPlot.Purpose")
  
  
  # final column renaming to match metadata
  HerbsPoints <- HerbsPoints %>% 
    dplyr::rename(
      #Macroplot_Purpose = MacroPlot.Purpose,
      Purpose = MacroPlot.Purpose,
      #Macroplot_Type = MacroPlot.Type,
      Type = MacroPlot.Type,
      Macroplot_UV1 = MacroPlot.UV1,
      Macroplot_UV2 = MacroPlot.UV2,
      Macroplot_UV3 = MacroPlot.UV3,
      Macroplot_UV4 = MacroPlot.UV4,
      Macroplot_UV5 = MacroPlot.UV5,
      Macroplot_UV6 = MacroPlot.UV6,
      Macroplot_UV7 = MacroPlot.UV7,
      Macroplot_UV8 = MacroPlot.UV8,
      #Macroplot_Name = MacroPlot.Name,
      Macroplot = MacroPlot.Name,
      #MonitoringStatus_Name = Monitoring.Status,
      MonStatus = Monitoring.Status,
      #MonitoringStatus_Prefix = Status.Prefix,
      #MonitoringStatus_Base = Status.Base,
      #MonitoringStatus_Suffix = Status.Suffix,
      #MonitoringStatus_Order = Status.Order,
      MonStatusOrd = Status.Order,
      #SampleEvent_Date = Date,
      SampleEventDate = Date,
      #SampleEvent_Date_Year = Date_Year
      SampleEventDate_Year = Date_Year
      )
  
  
  # save file
  write.csv(HerbsPoints, paste0(path_save, target_park, "_Data_Cover - Points (metric).csv"), quote = FALSE, row.names = FALSE) 
}
```
