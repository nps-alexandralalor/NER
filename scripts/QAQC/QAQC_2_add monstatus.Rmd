---
title: "QAQC GRCA MetaData"
author: "Alexandra Lalor"
output:
  html_document:
    theme: readable
    highlight: 
    toc: yes
    toc_depth: 3
    toc_float:
      smooth_scroll: yes
    code_download: true
  pdf_document:
    toc: yes
    toc_depth: '3'
---

# Before Starting

### Setup

```{r setup, include=FALSE}
## Markdown Options
knitr::opts_chunk$set(echo = FALSE, error = FALSE, warnings = FALSE, message = FALSE)
```

```{r install packages, include=FALSE}
## Install packages (if needed)

# install.packages("tidyverse")
# install.packages("Rtools")
# install.packages("janitor")
# install.packages("condformat")
# install.packages("knitr")
# install.packages("here")
```

```{r load packages, include=FALSE}
## Load Packages

# tidyverse and dplyr have lots of useful functions for data cleaning
library(tidyverse)
library(dplyr)
library(plyr)
# janitor has functions to find duplicates
library(janitor)
# writexl is used to create excel output files
library(writexl)
# condformat is used to format excel output files
library(condformat)
# knitr is used to create output files from R Markdown
library(knitr)
# "here" helps you easily find and reference your working directory
library(here)
```

### Adjust File Paths

```{r import data, include=FALSE}
# Identify working directory.
here()

# designate target park(s)
target_park <- "RICH"

# Load in data.
path_file <- "C:/Users/alalor/OneDrive - DOI/NER/FireFX/FFI Data Management/Exports/_metadata/"
path_data <- paste0(path_file, target_park, "/")
path_errors <- paste0(here(), "/output/errors/")
path_errors_name <- "Metadata QAQC Errors"
```

### Load Data

```{r load data, include=FALSE}
## Load Data
MetadataReport <- read.csv(paste0(path_data, target_park, "_", "MetadataReport.csv"))
```

# Clean Data

```{r}

```

# Add Columns?

-   PlotType_Name (FMH, RAP, etc...)

-   Macroplot_Code

-   Macroplot_Num

-   Park (GRCA, WACA)

-   Park_Unit (North, South)

-   Burn_Unit

-   Disturbance_Type (burn, thin, etc...)

```{r}
# MetadataReport <- MetadataReport %>%
#   # PlotType_Name
#   mutate(PlotType_Name = "FMH") %>%
#   # reorder columns
#   relocate(PlotType_Name, .before = Macroplot)
```

# Monitoring Status

Create columns for Entry (number of disturbances), Status (pre or post disturbance), and Time Since disturbance (i.e., Year 1) via break down of the Monitoring Status field

```{r}
# Isolate different Monitoring Statuses
MonStatus <- MetadataReport %>%
  select(MonStatusOrd, MonStatus) %>%
  mutate(MonStatusOrd = NA)

# Combine Monitoring Statuses, keep only unique values
MonStatus <- unique(MonStatus)

# Create column with consistent naming
MonStatus <- MonStatus %>%
  mutate(MonStatus_new = ifelse(MonStatus == "Pre", "00 Pre 00", 
                                ifelse(MonStatus == "Pre 2", "00 Pre2 00",
                                       ifelse(MonStatus == "Burn", "00 Burn 00",
                                              ifelse(MonStatus == "Herbicide", "00 Herbicide 00",
                                                     ifelse(MonStatus == "Mow", "00 Mow 00",
                                                            ifelse(MonStatus == "Mechanical", "00 Mechanical 00", MonStatus)))))))

order <- seq(1, nrow(MonStatus))

# Extract info
MonStatus_merge <- MonStatus %>%
  arrange(MonStatus_new) %>%
  mutate(MonStatusOrd = order) %>%
  separate(MonStatus_new, sep = " ", into = c("Entry","Status","TimeSince"), remove = F) %>%
  # fix up classifications
  mutate(Status = ifelse(Status == "Yr", "Post", Status)) %>%
  mutate(TimeSince = ifelse(Status %in% c("Pre", "Pre2", "Burn", "Herbicide", "Mow", "Mechanical"), NA, TimeSince)) %>%
  mutate(Entry = ifelse(Status %in% c("Burn", "Herbicide", "Mow", "Mechanical"), NA, Entry)) %>%
  # make columns numeric
  mutate(Entry = as.numeric(Entry),
         TimeSince = as.numeric(TimeSince)) %>% 
  select(!MonStatus_new)
```

# Merge

```{r}
#### Merge Metadata report with monitoring status summary
MetadataReport_all <- merge(MetadataReport, MonStatus_merge, by = c("MonStatus"), all = T) %>%
  relocate(MonStatus, .before = MonStatusOrd) %>%
  relocate(LegacyMonStatus, .before = MonStatus)
```
